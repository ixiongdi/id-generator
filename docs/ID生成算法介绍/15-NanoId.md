# NanoId 生成算法介绍

## 1. 概述
NanoId 是一个**轻量级、安全的短ID生成库**，由Andrey Sitnik于2017年开源。其设计目标是在保证高安全性的同时生成更短的唯一ID，广泛应用于URL短链接、数据库主键、分布式系统标识等场景。

## 2. 核心特性
| 特性                | 说明                                                                 |
|---------------------|----------------------------------------------------------------------|
| 超短长度            | 默认生成21字符ID（比UUID的36字符短42%），自定义长度可压缩至10-64字符   |
| 高安全性            | 基于加密安全随机数生成器（CSPRNG），碰撞概率极低（10^18次调用碰撞概率<1%） |
| 灵活字符集          | 默认使用64字符集（A-Za-z0-9_-），支持自定义字符集（如排除易混淆字符） |
| 跨平台支持          | 提供JavaScript、Python、Java等50+语言的官方实现，适配多技术栈         |
| 无依赖设计          | 核心实现仅依赖系统级随机数接口，体积小（JS版本仅130B）                |

## 3. 数据结构与生成逻辑
NanoId ID本质是**基于自定义字符集的随机字符串**，生成流程如下：

1. **随机字节生成**：通过系统CSPRNG（如Node.js的`crypto.randomBytes`）获取N字节随机数（N=ID长度×log₂(字符集大小)/8）
2. **字符映射**：将每个字节值模字符集长度，映射为字符集中的具体字符
3. **结果拼接**：将映射后的字符按顺序拼接，生成最终ID

### 示例计算（默认配置）
- 字符集大小：64（log₂64=6位/字符）
- ID长度：21字符 → 需要21×6=126位随机数 → 126/8≈16字节（实际取16字节）
- 生成结果：`V1StGXR8_Z5jdHi6B-myT`

## 4. 与其他短ID方案对比
| 特性                | NanoId               | UUIDv4               | 自定义短ID（如Base62） |
|---------------------|----------------------|----------------------|------------------------|
| 典型长度            | 21字符               | 36字符               | 22字符（Base62 UUID）  |
| 安全性              | ✅ CSPRNG             | ✅ CSPRNG             | ❌ 可能使用弱随机源     |
| 字符集灵活性        | ✅ 完全自定义         | ❌ 固定十六进制       | ✅ 需手动实现           |
| 碰撞概率（1e9次调用）| 1e-9（21字符）       | 4e-16（36字符）       | 5e-8（22字符）         |
| 体积（JS版本）       | 130B                 | 8KB+                 | 需自行实现             |

## 5. 使用建议
- **长度选择**：根据业务需求平衡长度与碰撞概率（如10字符适用于临时ID，21字符适用于长期存储）
- **字符集优化**：排除易混淆字符（如`l`/`I`/`O`/`0`）时，建议字符集大小保持为2的幂次（如58字符需调整为64字符）
- **性能注意**：避免在高并发场景中频繁调用（CSPRNG可能成为瓶颈），可预生成ID缓存使用
- **存储优化**：字符串形式直接存储（推荐`VARCHAR(64)`），避免额外编码转换