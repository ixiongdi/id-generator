# KSUID（K-Sortable Unique ID）生成算法介绍

## 1. 概述
KSUID（K-Sortable Unique ID）是一种**可按生成时间排序的全局唯一ID**，由Segment公司设计并开源。其核心目标是解决分布式系统中ID的全局唯一性与时间可排序性之间的平衡问题，适用于需要按时间顺序处理或展示ID的场景（如日志排序、事件追踪）。

## 2. 核心特性
- **时间可排序**：ID中显式包含时间戳字段，生成后可直接按字符串字典序排序（无需解析时间戳）
- **全局唯一**：通过时间戳+随机数的组合设计，在合理时间范围内（约136年）保证分布式环境下的唯一性
- **紧凑性**：默认采用Base62编码（27字节），比UUID（36字节）更节省存储和传输空间
- **防时钟回拨**：通过随机数冗余设计，对时钟回拨问题有一定容灾能力

## 3. 数据结构设计
KSUID采用固定长度的二进制结构（共16字节），具体分段如下：

| 字段       | 长度（字节） | 说明                                                                 |
|------------|--------------|----------------------------------------------------------------------|
| 时间戳     | 4            | 32位无符号整数（UNIX时间戳，单位秒），覆盖范围：2017-02-07 到 2153-10-07 |
| 随机数     | 12           | 96位加密安全随机数（由CSPRNG生成），保证唯一性                        |

### 编码示例（Base62）
原始二进制数据：`[0x5A 0x9E 0x6B 0x20][0x8B 0x2A 0x7D 0x4C 0x1F 0x9A 0x3E 0x5B 0x7F 0x8D 0x9C 0xAB]`  
Base62编码结果：`1X8D1Zk5Q6yLJg3z4W7v8X`

## 4. 与其他ID方案对比
| 特性         | KSUID                  | Snowflake              | UUID v4               |
|--------------|------------------------|------------------------|-----------------------|
| 时间可排序   | ✅ 直接字符串排序       | ✅ 需解析时间戳字段     | ❌ 无序                |
| 全局唯一性   | ✅ 12字节随机数+时间戳  | ✅ 依赖机器ID+序列号   | ✅ 122位随机数         |
| 长度（Base62）| 27字节                 | 20字节（Base62）       | 36字节（标准格式）     |
| 时钟依赖     | 低（随机数冗余）       | 高（需严格时钟同步）    | 无                    |
| 适用场景     | 时间敏感型分布式系统   | 高并发有序ID生成       | 强唯一性无排序需求场景 |

## 5. 使用注意事项
- **时间戳精度**：默认使用秒级时间戳（4字节），如需更高精度（如毫秒）需扩展时间戳字段（需调整总长度）
- **随机数来源**：必须使用加密安全的随机数生成器（如`crypto/rand`），避免碰撞风险
- **编码选择**：Base62编码比Base64更友好（无特殊符号），但Base32/Base58等编码可根据具体场景调整
- **存储建议**：二进制原始数据（16字节）比编码后字符串更节省存储，建议数据库使用BINARY类型存储