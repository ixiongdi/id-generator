# ObjectID 生成算法介绍

## 1. 概述
ObjectID 是 MongoDB 数据库默认使用的**12字节全局唯一标识符**，设计目标是在分布式环境下快速生成、全局唯一且隐含时间信息。广泛应用于MongoDB文档主键、分布式系统事件标识等场景。

## 2. 核心特性
| 特性                | 说明                                                                 |
|---------------------|----------------------------------------------------------------------|
| 紧凑性              | 固定12字节（24位十六进制字符串），比UUID（16字节）更节省存储         |
| 时间隐含性          | 前4字节为UNIX时间戳（秒级），可直接解析生成时间（无需额外存储字段）  |
| 分布式唯一性        | 通过机器ID+进程ID+计数器组合，保证不同机器/进程下的唯一性             |
| 高生成效率          | 纯内存计算生成，无IO操作，适合高并发场景（单节点可生成10^7次/秒）     |
| 自增有序性          | 同一机器/进程下按生成顺序递增，优化数据库索引性能                    |

## 3. 数据结构设计
ObjectID 采用12字节固定二进制结构（24位十六进制字符串表示），具体分段如下：

| 字段       | 长度（字节） | 说明                                                                 |
|------------|--------------|----------------------------------------------------------------------|
| 时间戳     | 4            | 32位UNIX时间戳（秒级），覆盖范围：1970-01-01 到 2106-02-07             |
| 机器ID     | 3            | 3字节机器标识（通常为网卡MAC地址哈希或系统随机数）                    |
| 进程ID     | 2            | 16位进程ID（避免同一机器不同进程生成冲突）                            |
| 计数器     | 3            | 24位自增计数器（同一秒内同一进程最多生成16,777,215个ID）              |

### 示例解析（十六进制字符串）
原始十六进制：`650a8d9d7b1a854b7c0c7e00`  
解析结果：
- 时间戳：`0x650a8d9d` → 十进制1,705,572,765 → 2023-11-18 15:32:45
- 机器ID：`0x7b1a85` → 机器唯一标识（如服务器A的MAC哈希）
- 进程ID：`0x4b7c` → 十进制19324（当前MongoDB服务进程ID）
- 计数器：`0x0c7e00` → 十进制818,688（本秒内第818,688个生成的ID）

## 4. 与其他分布式ID方案对比
| 特性                | ObjectID              | Snowflake              | UUIDv4               |
|---------------------|-----------------------|------------------------|-----------------------|
| 长度                | 12字节（24字符）       | 8-16字节（Base62）      | 16字节（36字符）       |
| 时间隐含性          | ✅ 直接解析时间戳       | ✅ 需解析时间字段        | ❌ 无时间信息           |
| 分布式唯一性        | ✅ 机器+进程+计数器     | ✅ 机器ID+序列号         | ✅ 122位随机数          |
| 自增有序性          | ✅ 同进程同秒递增       | ✅ 全局有序              | ❌ 无序                |
| 生成效率            | ✅ 极高（无网络依赖）    | ❌ 依赖时钟同步          | ✅ 高（随机数生成）      |
| 典型场景            | MongoDB文档主键        | 高并发有序ID生成        | 强唯一性无排序需求     |

## 5. 使用注意事项
- **时间精度**：仅支持秒级时间戳（无法区分同一秒内的顺序），如需毫秒级需扩展时间字段
- **机器ID冲突**：多实例部署时需确保机器ID唯一（建议使用Docker容器ID或云服务器实例ID）
- **计数器溢出**：单进程单秒内生成超过16M个ID时会溢出（实际生产环境极少达到）
- **存储优化**：推荐存储原始12字节二进制（比24字符字符串节省50%空间）
- **索引优化**：默认按生成顺序递增，MongoDB自动为`_id`字段创建升序索引，查询效率更高