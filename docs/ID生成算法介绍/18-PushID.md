# PushID 生成算法介绍

## 1. 概述
PushID 是 Firebase 实时数据库设计的**20字节有序唯一标识符**，专为高并发场景下的有序ID生成设计。其核心特点是在分布式环境中生成的ID可按插入顺序自然排序，同时保持全局唯一性，广泛应用于实时数据库记录主键、消息队列有序标识等场景。

## 2. 核心特性
| 特性                | 说明                                                                 |
|---------------------|----------------------------------------------------------------------|
| 紧凑有序性          | 20字节字符串（含12位时间戳+8位随机熵），字符串可直接按字典序排序     |
| 时间相关性          | 前12位为Base64编码的毫秒级时间戳（覆盖范围：1970-01-01至今）          |
| 分布式唯一性        | 后8位包含机器/进程标识+随机数，避免不同实例生成冲突                   |
| 高并发友好          | 单实例每秒可生成百万级ID，支持多客户端同时写入保持顺序性               |
| 兼容文本存储        | 纯ASCII字符（无特殊符号），可直接作为数据库字符串索引                 |

## 3. 数据结构设计
PushID 采用20字节固定长度字符串结构，具体分段如下：

| 字段       | 长度（字符） | 编码方式       | 说明                                                                 |
|------------|--------------|----------------|----------------------------------------------------------------------|
| 时间戳     | 12           | Base64         | 48位毫秒级时间戳（自1970-01-01以来的毫秒数）                         |
| 随机熵     | 8            | Base64         | 包含52位随机数+12位实例标识（确保不同服务器/进程生成唯一ID）          |

### 示例解析
原始PushID：`-KxQl_5zQ2eJzW1cZgXa`
解析结果：
- 时间戳部分（前12位）：`-KxQl_5zQ2eJ` → 解码为毫秒时间戳1627833600000（对应2021-08-02 00:00:00）
- 随机熵部分（后8位）：`zW1cZgXa` → 包含服务器A的实例ID（`zW1c`）和随机数（`ZgXa`）

## 4. 与其他有序ID方案对比
| 特性                | PushID               | Snowflake            | OrderedUUID            |
|---------------------|----------------------|----------------------|------------------------|
| 长度                | 20字节               | 8-16字节（Base62）   | 36字节（标准UUID格式）  |
| 时间精度            | 毫秒级               | 毫秒级               | 秒级（需扩展）          |
| 字符串排序能力      | ✅ 直接字典序         | ❌ 需数值转换         | ✅ 调整字段顺序后支持    |
| 分布式唯一性        | ✅ 实例ID+随机数      | ✅ 机器ID+序列号      | ✅ UUID原生唯一性       |
| 典型场景            | 实时数据库有序写入   | 高并发全局有序ID     | 数据库索引优化          |

## 5. 使用注意事项
- **时间同步**：依赖客户端本地时间（需校准避免时钟回拨），建议配合服务端时间校验机制
- **随机熵强度**：后8位包含固定实例标识，多实例部署时需确保实例ID唯一（如使用云服务器实例ID）
- **存储优化**：推荐存储原始20字节字符串（比长整型更节省索引空间）
- **性能限制**：单客户端生成速率受限于本地时钟精度（毫秒级间隔最多生成1个ID/ms）
- **兼容扩展**：可在PushID前拼接业务标识（如`user_-KxQl_5zQ2eJzW1cZgXa`）实现业务分类排序