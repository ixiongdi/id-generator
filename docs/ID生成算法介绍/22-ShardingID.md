# ShardingID 分片ID生成算法

## 一、概述
ShardingID 是专为分布式分片系统设计的唯一ID生成算法，核心目标是通过ID结构与分片策略的绑定，实现数据分布的负载均衡与快速路由。适用于需要按ID分片存储/查询的场景（如数据库分库分表、分布式缓存集群）。

## 二、核心特性
1. **分片友好性**：ID中显式包含分片标识（Shard ID），可直接通过ID解析定位目标分片
2. **负载均衡**：通过时间戳+序列号组合设计，确保同一分片内ID按时间有序生成，避免热点分片
3. **可扩展性**：支持动态调整分片数量（通过扩展分片标识位长度实现）
4. **轻量高效**：生成过程无网络调用，单节点QPS可达百万级
5. **可解析性**：ID结构包含明确业务含义字段（如时间戳、分片ID、序列号）

## 三、数据结构设计
典型64位ShardingID结构（二进制）：
```
[41位时间戳][10位分片ID][13位序列号]
```
- 时间戳（毫秒级）：支持约69年（2^41 / 1000ms/3600s/24h/365d ≈ 69年）
- 分片ID：支持1024个分片（2^10）
- 序列号：单分片单毫秒内可生成8192个ID（2^13）

## 四、与其他分片方案对比
| 特性         | ShardingID          | 雪花算法(Snowflake)       | UUIDv4                |
|--------------|---------------------|---------------------------|-----------------------|
| 分片支持     | 显式分片标识        | 需额外存储节点-分片映射   | 无分片信息            |
| 有序性       | 时间有序            | 时间有序                  | 无序                  |
| 分片定位     | 直接解析ID          | 需查询节点映射表          | 无法定位              |
| 最大分片数   | 1024（可扩展）      | 1024（固定）              | N/A                   |
| 单分片QPS    | 8192/ms             | 4096/ms                   | 无限制（但无序）      |

## 五、使用注意事项
1. **时间同步**：需保证各生成节点时钟同步（误差<1ms），避免时间回拨导致ID冲突
2. **分片扩容**：增加分片时需同步调整ID中分片标识位长度（如从10位扩展到12位），需考虑历史ID兼容
3. **序列号溢出**：单分片单毫秒内生成ID超过8192时，需等待下一毫秒再生成
4. **存储优化**：建议使用Long类型存储（比字符串类型节省50%存储空间）
5. **前缀扩展**：可在ID前拼接业务标识（如订单前缀'OD'），形成'OD-1234567890'格式提升可读性
6. **冲突检测**：生产环境建议开启ID唯一性校验（通过数据库唯一索引或缓存验证）